#!/bin/sh
#set -x
# Copyright (C) 2002-2005 Flavio Stanchina
# Copyright (C) 2005-2006 Aric Cyr
# Copyright (C) 2007 Mario Limonciello
# Copyright (C) 2009 Alberto Milone

set -e

NAME=MODULE_NAME
VERSION=MODULE_VERSION
PACKAGE_NAME=$NAME-dkms
DEB_NAME=$(echo $PACKAGE_NAME | sed 's,_,-,')
CVERSION=`dpkg-query -W -f='${Version}' $DEB_NAME | awk -F "-" '{print $1}' | cut -d\: -f2`
ARCH=`dpkg --print-architecture`

################################################################
#the following script will be executed before deb was installed
rm -rf /var/lib/dpkg/lock
rm -rf /var/lib/dkms/$NAME
rm -rf /var/lib/dpkg/info/$NAME-dkms*

if [ -f "/usr/bin/cnmon" ]; then
        rm -rf /usr/bin/cnmon
fi

if [ -d "/usr/bin/cnmon" ]; then
        rm -rf /usr/bin/cnmon
fi

if [ -e "/usr/bin/cambricon-bug-report.sh" ]; then
        rm -rf /usr/bin/cambricon-bug-report.sh
fi
if [ -e "/usr/lib/systemd/system-sleep/cambricon_mlu_sleep.sh" ]; then
        rm -rf /usr/lib/systemd/system-sleep/cambricon_mlu_sleep.sh
fi
if [ -e "/lib/systemd/system-sleep/cambricon_mlu_sleep.sh" ]; then
        rm -rf /lib/systemd/system-sleep/cambricon_mlu_sleep.sh
fi
message="APT::Sandbox::User \"root\";"
if cat /etc/apt/apt.conf.d/99update-notifier | grep "$message">/dev/null;then
	echo "APT already is root"
else
#fix the bug "N: Can't drop privileges for downloading as file '/home/jenkins/testDriver/cambricon-driver-dkms_3.1_all.deb' couldn't be accessed by user '_apt'. -            pkgAcquire::Run (13: Permission denied)"
echo "APT::Sandbox::User \"root\";" >> /etc/apt/apt.conf.d/99update-notifier
fi
################################################################

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
