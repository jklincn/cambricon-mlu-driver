============================================
Cambricon irqbalance Upgrade Guide
============================================

Part I - What is Irqbalance?
Irqbalance is a daemon to help balance the CPU load generated by interrupts
across all systems CPUs. Irqbalance identifies the highest volume
interrupt sources, and isolates them to a single CPU, so that the CPU load is
spread as much as possible over an entire processor set, with the cache
miss rates for Irq handlers minimized.

You can check/start/stop/restart it by shell command with sudo permissions.
For example:
$ sudo service irqbalance status
```
   Redirecting to /bin/systemctl status irqbalance.service
   irqbalance.service - irqbalance daemon
   Loaded: loaded (/usr/lib/systemd/system/irqbalance.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2020-11-10 16:36:20 CST; 11 months 7 days ago
 Main PID: 6937 (irqbalance)
    Tasks: 1
   CGroup: /system.slice/irqbalance.service
           └─6937 /usr/sbin/irqbalance --foreground
```


Part II - Why to upgrade Irqbalance?
1). Devices of accelerator card type are not supported in versions lower than v1.1.0.
2). A known bug for getting and binding wrong-numaid was found in versions lower than v1.5.0 (fixed in v1.5.0).
In situation 1 and 2, all interrupts will be reported on CPU0, which leads to quite high CPU0.
So it is recommended to upgrade Irqbalance to versions higher than v1.5.0.


Part III How to upgrade Irqbalance?
1). Install numactl-devel lib first for compiling dependency.
ubuntu: $ sudo apt-get install numactl-devel
centos: $ sudo yum install numactl-devel

2). Get the source code from github.com/irqbalance/irqbalance/tags.

3). Build and install Irqbalance.
Download irqbalance-1.8.0.tar.gz for example.
$ tar zxvf irqbalance-1.8.0.tar.gz
$ cat README.md -- you can see steps
```
./autogen.sh
./configure [options]
make
make install
```

4). Restart the service.
$ sudo service irqbalance restart
```Redirecting to /bin/systemctl restart irqbalance.service```


Part IV - How to check whether Irqbalance works normally?
After restarting Irqbalance service for 10 seconds, run a DMA H2D or D2H copy-test and
use `cat /proc/interrupts` to see
whether all interrupts are balanced to different CPUs or not.


